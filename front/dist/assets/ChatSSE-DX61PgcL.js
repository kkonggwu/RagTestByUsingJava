import{d as g,r as h,e as y,f as S,c,a as s,g as T,F as w,h as E,i as b,v as D,j as I,o as i,n as M,k,_ as x}from"./index-DumoIkdR.js";import{e as v,u as U}from"./text-YWM8f9FD.js";function C(){const r=new Date,l=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),n=String(r.getTime()).slice(-6),m=Math.random().toString(36).slice(2,8);return`chat_${l}${a}${o}_${n}_${m}`}const $={class:"chat-page"},H={key:0,class:"chat-avatar"},L={key:1,class:"chat-avatar"},N=["innerHTML"],B=g({__name:"ChatSSE",setup(r){const l=h(""),a=h([]),o=h(""),n=h(null);y(()=>{l.value=C()}),S(a,async()=>{await k(),n.value&&(n.value.scrollTop=n.value.scrollHeight)},{deep:!0});function m(){const d=o.value.trim();if(!d)return;a.value.push({id:crypto.randomUUID(),role:"user",html:v(d)}),o.value="";const e=crypto.randomUUID();a.value.push({id:e,role:"assistant",html:""});const t=new URL("/api/hyper_project/chat/sync",window.location.origin);t.searchParams.set("message",d),t.searchParams.set("chatId",l.value);const _=U(t.toString(),u=>{if(u==="[DONE]"||u==="DONE")return;const p=a.value.find(f=>f.id===e);p&&(p.html+=v(u))},u=>{});setTimeout(_,12e4)}return(d,e)=>(i(),c("div",$,[e[2]||(e[2]=s("header",{class:"chat-header chat-header-common"},[s("span",{class:"chat-header-avatar"},"💬"),T("问答应用")],-1)),s("div",{class:"chat-history chat-history-common",ref_key:"historyEl",ref:n},[(i(!0),c(w,null,E(a.value,t=>(i(),c("div",{key:t.id,class:M(["chat-msg",t.role])},[t.role==="assistant"?(i(),c("div",H,"🤖")):(i(),c("div",L,"🧑")),s("div",{class:"chat-bubble",innerHTML:t.html},null,8,N)],2))),128))],512),s("form",{class:"chat-input chat-input-common",onSubmit:I(m,["prevent"])},[b(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),placeholder:"说点什么..."},null,512),[[D,o.value]]),e[1]||(e[1]=s("button",{type:"submit"},"发送",-1))],32)]))}}),j=x(B,[["__scopeId","data-v-211b99e6"]]);export{j as default};
